(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{4832:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var r=n(9521),o=n(29),i=n(9499),s=n(7794),u=n.n(s),c=n(1163),a=n.n(c),l=n(1896),f=n(886),d=n(1748),b=n(9295),p=n(3289),m=n(2544),h=n(2951),v=n(5885),g=n(3735),y=n(4093),w=n(4480),x=n(7294),j=n(8767);n(35);var P=n(1569),_=n(129),S=n(7044),E=n(8254),O=n(5893),D=n(3454);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){(0,i.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Z=r.ZP.div.withConfig({displayName:"Subscribe__SubscribeContainer",componentId:"sc-qj8smm-0"})(["width:596px;min-height:100vh;padding :170px 0;@media ","{min-height:100vh;width:327px;padding:120px 0;@media ","{padding:115px 0;}}"],g.Uh.mobileL,g.Uh.mobileL),C=r.ZP.div.withConfig({displayName:"Subscribe__SubscribeButtonContainer",componentId:"sc-qj8smm-1"})(["display:flex;justify-content:center;width:100%;margin:24px auto;"]),k=(0,r.ZP)(g.zx).withConfig({displayName:"Subscribe__SubscribeButton",componentId:"sc-qj8smm-2"})(["width:100%;border-radius:5px;font-size:18px;line-height:38px;font-weight:",";margin-top:40px;@media ","{border-radius:5px;margin-top:30px;}"],(0,P.U)("bold"),g.Uh.mobileL),A=function(){var e,t,n,r,i=(0,w.sJ)((0,y.TD)("subscribe")),s=(0,w.Zl)((0,y.TD)("subscribe")),c=(0,w.sJ)(y.bw),g=(0,w.Zl)(y.bw),P=(0,w.Zl)((0,y.cI)("subscribe")),I=(0,w.sJ)((0,_.R9)("subscribe")),A=(0,w.Zl)((0,_.R9)("subscribe")),L=(0,w.sJ)((0,y.cI)("subscribe")),T=(0,w.sJ)((0,S._)("subscribe")),J=(0,w.Zl)((0,S._)("subscribe")),U=(0,w.sJ)((0,y.FX)("subscribe")),R=(0,w.Zl)((0,y.FX)("subscribe")),K=(0,w.sJ)((0,E.yM)("subscribe")),X=(0,w.Zl)((0,E.yM)("subscribe")),B=function(){X(function(e){return N(N({},e),{},{addressList:[],addressNo:null,addModal:!1,addressAvailable:null})}),A(function(e){return[]}),g(null),s(function(){return[]}),R(function(){return[]}),J(function(){return[]}),P(function(e){return N(N({},e),{},{list:[]})})},F=(e=(0,o.Z)(u().mark(function e(t){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Y)({method:"GET",withCredentials:!0,url:"".concat(D.env.NEXT_PUBLIC_API_SERVER,"/login/check")});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}),M=(t=(0,o.Z)(u().mark(function e(t){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Y)({method:"POST",withCredentials:!0,data:t,url:"".concat(D.env.NEXT_PUBLIC_API_SERVER,"/subscribe/create")});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)});(0,j.useQuery)("submitSubscribe",function(){return M(c)},{enabled:!1,staleTime:1/0,retry:!1,onSuccess:function(e){200===e.status&&("fail"===e.data.status?alert("결제 실패 :".concat(e.data.message)):(alert("구독이 완료되었습니다."),B(),localStorage.removeItem("tmpSubscribeInfo"),window.location.href="/mypage"))},onError:function(e){console.error("Error Occured : ",e)}}).refetch;var q=(0,j.useQuery)("checkLogin",function(){return F()},{retry:!1,onSuccess:function(e){},onError:function(e){console.error("Error Occured : ",e)}}).refetch;(0,x.useEffect)(function(){var e=JSON.parse(localStorage.getItem("tmpSubscribeInfo"));console.log("tmp",e),e&&(g(e),P(function(t){return N(N({},t),{},{list:e.product})}),s(function(t){return N(N({},t),{},{list:e.dows})}),X(function(t){return N(N({},t),{},{addModal:!1,addressNo:e.addressNo})}),R(function(t){return N(N({},t),{},{deliveryDate:e.deliveryDate})}))},[]),(0,x.useEffect)(function(){window.onbeforeunload=function(e){return localStorage.removeItem("tmpSubscribeInfo"),B(),!1};var e=function(e){q(),B(),localStorage.removeItem("tmpSubscribeInfo")};return a().events.on("routeChangeStart",e),function(){a().events.off("routeChangeStart",e),window.onbeforeunload=function(){}}},[]);var z=function(e){var t=0,n=0;if(c){for(var r=0;r<c.dows.length;r++){for(var o=c.dows[r],i=0,s=0,u=0;u<e.length;u++){var a=e[u];o===a.dow&&(s+=a.amount,i+=parseInt(a.price)*a.amount)}s>=2&&n++,t+=4*i}return console.log("amountDiscount :>> ",n),{totalPrice:t,defaultDiscountPrice:t-4e3*n,amountDiscount:n}}};return(0,x.useEffect)(function(){var e;if(L&&(null===(e=L.list)||void 0===e?void 0:e.length)!==0){var t=z(L.list),n=t.totalPrice,r=t.defaultDiscountPrice,o=t.amountDiscount;J(function(e){return N(N({},e),{},{milesAmount:0})}),g(function(e){return N(N({},e),{},{product:L.list,totalPrice:n,defaultDiscountPrice:r,amountDiscount:4*o})})}},[L.list]),(0,x.useEffect)(function(){console.log(I),g(function(e){return N(N({},e),{},{paymentNo:I.paymentNo})})},[I.paymentNo]),(0,x.useEffect)(function(){(null==c?void 0:c.totalPrice)<parseInt(T.milesAmount)?(J(function(e){return N(N({},e),{},{milesAmount:c.totalPrice})}),g(function(e){return N(N({},e),{},{coupon:T.coupon,milesAmount:c.totalPrice})})):g(function(e){return N(N({},e),{},{coupon:T.coupon,milesAmount:T.milesAmount})})},[T.coupon,T.milesAmount]),(0,x.useEffect)(function(){g(function(e){return N(N({},e),{},{deliveryDate:U.deliveryDate})})},[U.deliveryDate]),(0,x.useEffect)(function(){console.log("subscribeStateInfo",c)},[c]),(0,x.useEffect)(function(){g(function(e){return N(N({},e),{},{addressNo:K.addressNo})})},[K.addressNo]),(0,O.jsxs)(Z,{children:[(0,O.jsx)(f.Z,{stateKey:"subscribe"}),i&&(null===(n=i.list)||void 0===n?void 0:n.length)>=2&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(d.Z,{selectedDowList:i.list,stateKey:"subscribe"}),(0,O.jsx)(m.Z,{stateKey:"subscribe"})]}),i&&(null===(r=i.list)||void 0===r?void 0:r.length)>=2&&(null==c?void 0:c.deliveryDate)!=null&&(null==c?void 0:c.length)!==0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(b.Z,{stateKey:"subscribe"}),(0,O.jsx)(p.Z,{stateKey:"subscribe",selectedDowListLength:i.length,redirectUrl:"/subscribe",failRedirectUrl:"/subscribe"}),(0,O.jsx)(h.Z,{stateKey:"subscribe"}),(0,O.jsx)(v.Z,{paymentDetails:c}),(0,O.jsx)(C,{children:(0,O.jsx)(k,{onClick:function(){return!1},children:"구독 결제하기"})})]})]})},L=r.ZP.div.withConfig({displayName:"subscribe__SubscribeWrapper",componentId:"sc-1j1x5y1-0"})(["display:flex;align-items:center;flex-direction:column;width:100%;"]),T=function(){return(0,O.jsx)(L,{children:(0,O.jsx)(A,{})})}},2322:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/subscribe",function(){return n(4832)}])}},function(e){e.O(0,[26,674,255,345,411,774,888,179],function(){return e(e.s=2322)}),_N_E=e.O()}]);