(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{2824:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/experience",function(){return t(3417)}])},8482:function(e,n,t){"use strict";var i=t(7297),r=t(5893),o=t(9521);t(1163);var l=t(5675),c=t.n(l),s=t(9971);function a(){let e=(0,i.Z)(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  padding-bottom: 67px;\n  border-bottom: 1px solid #232323;\n  @media "," {\n    border-bottom:none;\n    padding-bottom: 0;\n    margin-bottom: 40px;\n  }\n"]);return a=function(){return e},e}function u(){let e=(0,i.Z)(["\n  text-align: center;\n  width: 100%;\n"]);return u=function(){return e},e}function d(){let e=(0,i.Z)(["\n    font-size: 28px;\n    line-height: 33px;\n    font-weight: ",";\n    margin-bottom: 12px;\n    @media "," {\n      font-size: 20px;\n      font-weight: ",";\n  }\n"]);return d=function(){return e},e}function p(){let e=(0,i.Z)(["\n  position: absolute;\n  left:0;\n  top:17px;\n  transform: translate(0%,-50%);\n  img{\n    cursor: pointer;\n  }\n  @media "," {\n    img{\n      width: 28px;\n      height: 28px;\n    } \n  }\n"]);return p=function(){return e},e}t(7294);let m=o.ZP.div(a(),s.Uh.mobileL),f=o.ZP.div(u()),x=o.ZP.div(d(),(0,s.Ue)("medium"),s.Uh.mobileL,(0,s.Ue)("regular")),h=o.ZP.div(p(),s.Uh.mobileL);n.Z=function(e){let{url:n,title:t,backward:i=!0}=e,o=e=>{location.href=e};return(0,r.jsxs)(m,{children:[!0===i&&(0,r.jsx)(h,{children:(0,r.jsx)(c(),{src:"/img/mypage/backward_icon.png",width:34,height:34,alt:"뒤로가기 아이콘",onClick:()=>o(n)})}),(0,r.jsx)(f,{children:(0,r.jsx)(x,{children:t})})]})}},3417:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return X}});var i=t(7297),r=t(5893),o=t(9521),l=t(1163),c=t.n(l),s=t(5838),a=t(4881),u=t(1292),d=t(6777);t(7505);var p=t(8027),m=t(4515),f=t(6798),x=t(8482),h=t(9971),g=t(4410),v=t(4480),y=t(5007);let w=(0,v.cn)({key:"experienceState/".concat((0,y.Z)()),default:{subscribeType:"experience",product:[],period:1,deliveryDate:null,dows:[],addressNo:null,paymentNo:null,totalPrice:null,milesAmount:0,coupon:{}}});var b=t(7294),Z=t(8767);t(2490);var E=t(8264),P=t(5004),_=t(5216),I=t(1819);t(3498);var N=t(3454);function j(){let e=(0,i.Z)(["\ndisplay: flex;\nflex-direction: column;\nalign-items: center;\nmargin  : 142px 0 170px;\n  @media "," {\n    padding: 80px 0px;\n    margin: 0px ;\n  }\n"]);return j=function(){return e},e}function D(){let e=(0,i.Z)(["\n    width: 596px;\n    min-height: 100vh;\n\n    @media "," {\n    width: 100%;\n    padding: 0 24px;\n    \n  }\n"]);return D=function(){return e},e}function S(){let e=(0,i.Z)(["\n  display:flex;\n  justify-content:  center;\n  width: 100%;\n  margin: 24px auto;\n"]);return S=function(){return e},e}function U(){let e=(0,i.Z)(["\n  width: 100%;\n  border-radius: 5px;\n  font-size:18px;\n  line-height: 38px;\n  font-weight: ",";\n  margin-top:40px;\n  @media "," {\n    border-radius: 5px;\n    margin-top:30px;\n  }\n"]);return U=function(){return e},e}function J(){let e=(0,i.Z)(["\n  width: 800px;\n margin-bottom: 5px;\n div{\n border-bottom: none;\n  }\n  @media "," {\n    width: 100%;\n    padding: 0 24px 0px;\n    div{\n      margin-bottom: 0px;\n    }\n  }\n"]);return J=function(){return e},e}function L(){let e=(0,i.Z)(["\n  width: 800px;\n  height: 145px;\n  font-size:18px;\n  line-height: 26px;\n  font-weight: ",";\n  background-color: #F1F1F5;\n  border-radius: 5px;\n  padding:30px;\n  margin-bottom : 44px;\n  span{\n    font-weight: ",";\n  }\n  @media "," {\n    width: 100%;\n    height: 100%;\n    font-size:12px;\n    line-height: 20px;\n    margin: 18px  auto 40px;\n    padding:20px 24px;\n  }\n  \n"]);return L=function(){return e},e}let O=o.ZP.div(j(),h.Uh.mobileL),T=o.ZP.div(D(),h.Uh.mobileL),k=o.ZP.div(S()),A=(0,o.ZP)(h.zx)(U(),(0,E.U)("bold"),h.Uh.mobileL),R=o.ZP.div(J(),h.Uh.mobileL),C=o.ZP.div(L(),(0,E.U)("regular"),(0,E.U)("semiBold"),h.Uh.mobileL);var F=function(){var e,n;let t=(0,v.sJ)((0,g.TD)("experience")),i=(0,v.Zl)((0,g.TD)("experience")),o=(0,v.sJ)(w),l=(0,v.Zl)(w),h=(0,v.Zl)((0,g.cI)("experience")),y=(0,v.sJ)((0,P.R9)("experience")),E=(0,v.sJ)((0,g.cI)("experience")),j=(0,v.sJ)((0,_._)("experience")),D=(0,v.Zl)((0,_._)("experience")),S=(0,v.sJ)((0,g.FX)("experience")),U=(0,v.Zl)((0,g.FX)("experience")),J=(0,v.sJ)((0,I.yM)("experience")),L=(0,v.sJ)((0,g.TD)("experience"));(0,v.Zl)((0,g.TD)("experience"));let F=(0,v.Zl)((0,I.yM)("experience")),z=(0,v.Zl)((0,P.R9)("experience")),M=()=>{F(e=>({...e,addressList:[],addressNo:null,addModal:!1,addressAvailable:null})),z(e=>[]),l(e=>({subscribeType:"experience",product:[],period:1,deliveryDate:null,dows:[],addressNo:null,paymentNo:null,totalPrice:null,milesAmount:0,coupon:{}})),i(()=>[]),U(()=>[]),D(()=>[]),h(e=>({...e,list:[]}))},X=async()=>await (0,s.Y)({method:"GET",withCredentials:!0,url:"".concat(N.env.NEXT_PUBLIC_API_SERVER,"/login/check")}),K=async()=>{let e=null,n=new URL(window.location).searchParams;return 0!=[...n.keys()].length?!0===JSON.parse(n.get("imp_success"))&&((e=JSON.parse(localStorage.getItem("tmpExperienceInfo"))).impUid=n.get("imp_uid")):e={...o},await (0,s.Y)({method:"POST",withCredentials:!0,data:e,url:"".concat(N.env.NEXT_PUBLIC_API_SERVER,"/subscribe/create")})},{refetch:q}=(0,Z.useQuery)(["submitExperience",o.impUid],K,{enabled:null!=o.impUid&&0!=o.impUid.length,staleTime:1/0,retry:!1,refetchOnWindowFocus:!1,refetchOnmount:!1,refetchOnReconnect:!1,onSuccess:e=>{200===e.status&&("fail"===e.data.status?alert("결제 실패 :".concat(e.data.message)):(alert("체험하기 구매가 완료되었습니다."),M(),localStorage.removeItem("tmpExperienceInfo"),c().replace("/mypage",void 0,{shallow:!1})))},onError:e=>{console.error("Error Occured : ",e)}}),{refetch:B}=(0,Z.useQuery)("checkLogin",()=>X(),{retry:!1,onSuccess:e=>{},onError:e=>{console.error("Error Occured : ",e)}});(0,b.useEffect)(()=>{console.log("deliveryDowStateInfo.list",L.list,E.list),l(e=>({...e,dows:L.list}))},[L.list]);let Q=()=>{let e=o.product;if(0===e.length)return alert("상품 수량을 선택해주세요."),!1;if(0!==e.length)for(let n=0;n<t.length;n++){let i=t[n],r=!1;for(let c=0;c<e.length;c++){let s=e[c];if(s.dow===i){r=!0;break}}if(!1===r)return alert("".concat(i,"요일 상품 수량을 선택해주세요.")),!1}if(!o.deliveryDate)return alert("배송 시작일을 선택해주세요."),!1;if(!o.addressNo)return alert("배송 주소를 입력해주세요."),!1;let a={...o};localStorage.setItem("tmpExperienceInfo",JSON.stringify(a)),IMP.request_pay({pg:"nice.nictest00m",pay_method:"card",merchant_uid:"order_monthly_".concat(Date.now()),name:"  - 체험하기",m_redirect_url:"http://".concat(location.host)+"/experience",amount:o.defaultDiscountPrice-parseInt(o.milesAmount)},function(e){!0===e.success&&"paid"===e.status?l(n=>({...n,impUid:e.imp_uid})):(alert("결제에 실패했습니다. 다시 시도해주세요."),localStorage.removeItem("tmpExperienceInfo"))})};(0,b.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("tmpExperienceInfo"));e?(l(e),h(n=>({...n,list:e.product})),i(n=>({...n,list:e.dows})),F(n=>({...n,addModal:!1,addressNo:e.addressNo})),U(n=>({...n,deliveryDate:e.deliveryDate}))):M()},[]),(0,b.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("tmpExperienceInfo"));console.log("Router.query",!c().query);let n=new URL(window.location).searchParams;0!==n.length&&e&&(!0===JSON.parse(n.get("imp_success"))?(console.log("mobile"),q()):!1===JSON.parse(n.get("imp_success"))&&localStorage.removeItem("tmpExperienceInfo"))},[]),(0,b.useEffect)(()=>{let e=e=>{B(),M(),localStorage.removeItem("tmpExperienceInfo")};return c().events.on("routeChangeStart",e),()=>{window.onbeforeunload=()=>{}}},[]);let V=e=>{let n=0,t=0;if(o){for(let i=0;i<o.dows.length;i++){let r=o.dows[i],l=0,c=0;for(let s=0;s<e.length;s++){let a=e[s];r===a.dow&&(c+=a.amount,l+=parseInt(a.price)*a.amount)}c>=2&&t++,n+=l}return console.log("amountDiscount :>> ",t),{totalPrice:n,defaultDiscountPrice:n-1e3*t,amountDiscount:t}}};return(0,b.useEffect)(()=>{var e;if(E&&(null===(e=E.list)||void 0===e?void 0:e.length)!==0){let{totalPrice:n,defaultDiscountPrice:t,amountDiscount:i}=V(E.list);D(e=>({...e,milesAmount:0})),l(e=>({...e,product:E.list,totalPrice:n,defaultDiscountPrice:t,amountDiscount:i}))}},[E.list]),(0,b.useEffect)(()=>{l(e=>({...e,paymentNo:y.paymentNo,paymentType:y.paymentType}))},[y.paymentNo]),(0,b.useEffect)(()=>{(null==o?void 0:o.totalPrice)<parseInt(j.milesAmount)?(D(e=>({...e,milesAmount:o.totalPrice})),l(e=>({...e,coupon:j.coupon,milesAmount:o.totalPrice}))):l(e=>({...e,coupon:j.coupon,milesAmount:j.milesAmount}))},[j.coupon,j.milesAmount]),(0,b.useEffect)(()=>{l(e=>({...e,deliveryDate:S.deliveryDate}))},[S.deliveryDate]),(0,b.useEffect)(()=>{IMP.init("imp81502857")},[]),(0,b.useEffect)(()=>{l(e=>({...e,addressNo:J.addressNo}))},[J.addressNo]),(0,r.jsxs)(O,{children:[(0,r.jsx)(R,{children:(0,r.jsx)(x.Z,{url:"/",title:"체험하기"})}),(0,r.jsxs)(C,{children:[(0,r.jsx)("p",{children:"- 선택한 횟수(요일)만큼 배송이 돼요."}),(0,r.jsx)("p",{children:"- 주 1회 배송은 오박이(보냉가방)가 아닌 하루체험팩(일회용)으로 배송이 돼요. "}),(0,r.jsx)("p",{children:"- 체험 상품은  하루 쉬어가기 및 하루 수량변경(취소)이 불가해요."})]}),(0,r.jsxs)(T,{children:[(0,r.jsx)(a.Z,{stateKey:"experience"}),t&&(null===(e=t.list)||void 0===e?void 0:e.length)>=1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{selectedDowList:t.list,stateKey:"experience",experience:!0}),(0,r.jsx)(p.Z,{stateKey:"experience"})]}),t&&(null===(n=t.list)||void 0===n?void 0:n.length)>=1&&(null==o?void 0:o.deliveryDate)!=null&&(null==o?void 0:o.length)!==0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{stateKey:"experience"}),(0,r.jsx)(m.Z,{stateKey:"experience",subscribePrice:o.defaultDiscountPrice}),(0,r.jsx)(f.Z,{paymentDetails:o,experience:!0}),(0,r.jsx)(k,{children:(0,r.jsx)(A,{onClick:Q,children:"체험하기"})})]})]})]})};function z(){let e=(0,i.Z)(["\n  display: flex;\n    align-items: center;\n    flex-direction: column;\n    width: 100%;\n"]);return z=function(){return e},e}let M=o.ZP.div(z());var X=function(){return(0,r.jsx)(M,{children:(0,r.jsx)(F,{})})}}},function(e){e.O(0,[26,129,798,979,140,177,774,888,179],function(){return e(e.s=2824)}),_N_E=e.O()}]);