(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{4832:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var r=n(9521),i=n(29),o=n(9499),s=n(7794),u=n.n(s),c=n(1163),a=n.n(c),l=n(1896),f=n(886),d=n(1748),b=n(9295),p=n(3289),m=n(2544),h=n(2951),g=n(5885),v=n(3735),y=n(4093),w=n(4480),x=n(7294),j=n(8767);n(35);var P=n(1569),S=n(129),_=n(7044),D=n(8254),O=n(5893),E=n(3454);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach(function(t){(0,o.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var I=r.ZP.div.withConfig({displayName:"Subscribe__SubscribeContainer",componentId:"sc-qj8smm-0"})(["width:596px;min-height:100vh;padding :170px 0;@media ","{min-height:100vh;width:327px;padding:120px 0;@media ","{padding:115px 0;}}"],v.Uh.mobileL,v.Uh.mobileL),C=r.ZP.div.withConfig({displayName:"Subscribe__SubscribeButtonContainer",componentId:"sc-qj8smm-1"})(["display:flex;justify-content:center;width:100%;margin:24px auto;"]),A=(0,r.ZP)(v.zx).withConfig({displayName:"Subscribe__SubscribeButton",componentId:"sc-qj8smm-2"})(["width:100%;border-radius:5px;font-size:18px;line-height:38px;font-weight:",";margin-top:40px;@media ","{border-radius:5px;margin-top:30px;}"],(0,P.U)("bold"),v.Uh.mobileL),L=function(){var e,t,n,r=(0,w.sJ)((0,y.TD)("subscribe")),o=(0,w.Zl)((0,y.TD)("subscribe")),s=(0,w.sJ)(y.bw),c=(0,w.Zl)(y.bw),v=(0,w.Zl)((0,y.cI)("subscribe")),P=(0,w.sJ)((0,S.R9)("subscribe")),N=(0,w.Zl)((0,S.R9)("subscribe")),L=(0,w.sJ)((0,y.cI)("subscribe")),k=(0,w.sJ)((0,_._)("subscribe")),J=(0,w.Zl)((0,_._)("subscribe")),T=(0,w.sJ)((0,y.FX)("subscribe")),U=(0,w.Zl)((0,y.FX)("subscribe")),K=(0,w.sJ)((0,D.yM)("subscribe")),R=(0,w.Zl)((0,D.yM)("subscribe")),X=function(){R(function(e){return Z(Z({},e),{},{addressList:[],addressNo:null,addModal:!1,addressAvailable:null})}),N(function(e){return[]}),c(null),o(function(){return[]}),U(function(){return[]}),J(function(){return[]}),v(function(e){return Z(Z({},e),{},{list:[]})})},F=(e=(0,i.Z)(u().mark(function e(t){return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Y)({method:"POST",withCredentials:!0,data:t,url:"".concat(E.env.NEXT_PUBLIC_API_SERVER,"/subscribe/create")});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)});(0,j.useQuery)("submitSubscribe",function(){return F(s)},{enabled:!1,staleTime:1/0,retry:!1,onSuccess:function(e){200===e.status&&("fail"===e.data.status?alert("결제 실패 :".concat(e.data.message)):(alert("구독이 완료되었습니다."),X(),localStorage.removeItem("tmpSubscribeInfo"),window.location.href="/mypage"))},onError:function(e){console.error("Error Occured : ",e)}}).refetch,(0,x.useEffect)(function(){var e=JSON.parse(localStorage.getItem("tmpSubscribeInfo"));console.log("tmp",e),e&&(c(e),v(function(t){return Z(Z({},t),{},{list:e.product})}),o(function(t){return Z(Z({},t),{},{list:e.dows})}),R(function(t){return Z(Z({},t),{},{addModal:!1,addressNo:e.addressNo})}),U(function(t){return Z(Z({},t),{},{deliveryDate:e.deliveryDate})}))},[]),(0,x.useEffect)(function(){window.onbeforeunload=function(e){return localStorage.removeItem("tmpSubscribeInfo"),X(),!1};var e=function(e){checkLoginRefetch(),X(),localStorage.removeItem("tmpSubscribeInfo")};return a().events.on("routeChangeStart",e),function(){a().events.off("routeChangeStart",e),window.onbeforeunload=function(){}}},[]);var M=function(e){var t=0,n=0;if(s){for(var r=0;r<s.dows.length;r++){for(var i=s.dows[r],o=0,u=0,c=0;c<e.length;c++){var a=e[c];i===a.dow&&(u+=a.amount,o+=parseInt(a.price)*a.amount)}u>=2&&n++,t+=4*o}return console.log("amountDiscount :>> ",n),{totalPrice:t,defaultDiscountPrice:t-4e3*n,amountDiscount:n}}};return(0,x.useEffect)(function(){var e;if(L&&(null===(e=L.list)||void 0===e?void 0:e.length)!==0){var t=M(L.list),n=t.totalPrice,r=t.defaultDiscountPrice,i=t.amountDiscount;J(function(e){return Z(Z({},e),{},{milesAmount:0})}),c(function(e){return Z(Z({},e),{},{product:L.list,totalPrice:n,defaultDiscountPrice:r,amountDiscount:4*i})})}},[L.list]),(0,x.useEffect)(function(){console.log(P),c(function(e){return Z(Z({},e),{},{paymentNo:P.paymentNo})})},[P.paymentNo]),(0,x.useEffect)(function(){(null==s?void 0:s.totalPrice)<parseInt(k.milesAmount)?(J(function(e){return Z(Z({},e),{},{milesAmount:s.totalPrice})}),c(function(e){return Z(Z({},e),{},{coupon:k.coupon,milesAmount:s.totalPrice})})):c(function(e){return Z(Z({},e),{},{coupon:k.coupon,milesAmount:k.milesAmount})})},[k.coupon,k.milesAmount]),(0,x.useEffect)(function(){c(function(e){return Z(Z({},e),{},{deliveryDate:T.deliveryDate})})},[T.deliveryDate]),(0,x.useEffect)(function(){console.log("subscribeStateInfo",s)},[s]),(0,x.useEffect)(function(){c(function(e){return Z(Z({},e),{},{addressNo:K.addressNo})})},[K.addressNo]),(0,O.jsxs)(I,{children:[(0,O.jsx)(f.Z,{stateKey:"subscribe"}),r&&(null===(t=r.list)||void 0===t?void 0:t.length)>=2&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(d.Z,{selectedDowList:r.list,stateKey:"subscribe"}),(0,O.jsx)(m.Z,{stateKey:"subscribe"})]}),r&&(null===(n=r.list)||void 0===n?void 0:n.length)>=2&&(null==s?void 0:s.deliveryDate)!=null&&(null==s?void 0:s.length)!==0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(b.Z,{stateKey:"subscribe"}),(0,O.jsx)(p.Z,{stateKey:"subscribe",selectedDowListLength:r.length,redirectUrl:"/subscribe",failRedirectUrl:"/subscribe"}),(0,O.jsx)(h.Z,{stateKey:"subscribe"}),(0,O.jsx)(g.Z,{paymentDetails:s}),(0,O.jsx)(C,{children:(0,O.jsx)(A,{onClick:function(){return!1},children:"구독 결제하기"})})]})]})},k=r.ZP.div.withConfig({displayName:"subscribe__SubscribeWrapper",componentId:"sc-1j1x5y1-0"})(["display:flex;align-items:center;flex-direction:column;width:100%;"]),J=function(){return(0,O.jsx)(k,{children:(0,O.jsx)(L,{})})}},2322:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/subscribe",function(){return n(4832)}])}},function(e){e.O(0,[230,674,255,345,411,774,888,179],function(){return e(e.s=2322)}),_N_E=e.O()}]);